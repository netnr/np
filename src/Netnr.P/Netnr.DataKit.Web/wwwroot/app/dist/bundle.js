(()=>{"use strict";var e={lk:()=>agGrid.LicenseManager.prototype.outputMissingLicenseKey=e=>{},defaultColDef:e=>Object.assign({width:150,maxWidth:2e3,filter:!0,sortable:!0,resizable:!0,menuTabs:["generalMenuTab","filterMenuTab","columnsMenuTab"]},e),autoGroupColumnDef:e=>Object.assign({width:300,maxWidth:2e3},e),optionDef:a=>Object.assign({localeText:e.localeText,defaultColDef:e.defaultColDef(),autoGroupColumnDef:e.autoGroupColumnDef(),rowGroupPanelShow:"always",enableBrowserTooltips:!0,rowSelection:"multiple",suppressRowClickSelection:!0,enableRangeSelection:!0,headerHeight:42,pagination:!1,paginationPageSize:100,cacheBlockSize:100,suppressMoveWhenRowDragging:!0,animateRows:!0},a),getAllRows:function(e,a=!0){let t=[];return a?e.api.forEachLeafNode((e=>t.push(e.data))):e.api.forEachNode((e=>t.push(e.data))),t},setGridLoading:function(e,a){if(e&&e.api)switch(a){case 1:e.api.hideOverlay();break;case 2:e.api.hideOverlay(),e.api.showNoRowsOverlay();break;default:e.api.showLoadingOverlay()}},localeText:{selectAll:"（全部）",selectAllSearchResults:"（全部搜索结果）",searchOoo:"搜索...",blanks:"（空）",noMatches:"未找到",filterOoo:"搜索...",equals:"等于",notEqual:"不等于",empty:"选择一项",lessThan:"小于",greaterThan:"大于",lessThanOrEqual:"小于等于",greaterThanOrEqual:"大于等于",inRange:"范围",inRangeStart:"开始值",inRangeEnd:"结束值",contains:"包含",notContains:"不包含",startsWith:"头包含",endsWith:"尾包含",dateFormatOoo:"yyyy-mm-dd",andCondition:"和",orCondition:"或",applyFilter:"确定",resetFilter:"重置",clearFilter:"清除",cancelFilter:"取消",textFilter:"文本搜索",numberFilter:"数字搜索",dateFilter:"日期搜索",setFilter:"项搜索",columns:"列",filters:"搜索",pivotMode:"枢轴模式",groups:"行组",rowGroupColumnsEmptyMessage:"拖拽列到此处进行分组",values:"值",valueColumnsEmptyMessage:"拖拽到此处合计",pivots:"列标签",pivotColumnsEmptyMessage:"拖拽到此处设置列标签",group:"分组",loadingOoo:"加载中...",noRowsToShow:"（空）",enabled:"启用",pinColumn:"固定列",pinLeft:"左固定",pinRight:"右固定",noPin:"取消固定",valueAggregation:"合计",autosizeThiscolumn:"当前列大小自适应",autosizeAllColumns:"所有列大小自适应",groupBy:"分组",ungroupBy:"取消分组",resetColumns:"重置列",expandAll:"展开全部",collapseAll:"折叠全部",copy:"复制",ctrlC:"Ctrl+C",copyWithHeaders:"复制带标题",paste:"粘贴",ctrlV:"Ctrl+V",export:"内置导出",csvExport:"导出 CSV",excelExport:"导出 Excel",excelXmlExport:"导出 XML",sum:"求和",min:"最小",max:"最大",none:"无",count:"总数",avg:"平均",filteredRows:"已过滤",selectedRows:"选中行",totalRows:"总行",totalAndFilteredRows:"行",more:"更多",to:"-",of:"，共",page:"当前",nextPage:"下一页",lastPage:"尾页",firstPage:"首页",previousPage:"上一页",pivotChartAndPivotMode:"图表枢轴 & 枢轴模式",pivotChart:"图表枢轴",chartRange:"范围图表",columnChart:"柱状图",groupedColumn:"分组",stackedColumn:"Stacked",normalizedColumn:"100% Stacked",barChart:"条形图",groupedBar:"分组",stackedBar:"Stacked",normalizedBar:"100% Stacked",pieChart:"饼形图",pie:"Pie",doughnut:"Doughnut",line:"线图",xyChart:"散点图及气泡图",scatter:"散点图",bubble:"气泡图",areaChart:"面积图",area:"面积",stackedArea:"叠堆",normalizedArea:"100% 叠堆",histogramChart:"直方图",pivotChartTitle:"图表枢轴",rangeChartTitle:"范围图表",settings:"设置",data:"数据",format:"格式",categories:"类别",defaultCategory:"(无)",series:"系数",xyValues:"X Y 值",paired:"配对模式",axis:"轴",navigator:"导航",color:"颜色",thickness:"Thickness",xType:"X Type",automatic:"Automatic",category:"类别",number:"数字",time:"时间",xRotation:"X 旋转",yRotation:"Y 旋转",ticks:"Ticks",width:"宽",height:"高",length:"长",padding:"填充",spacing:"间距",chart:"图表",title:"标题",titlePlaceholder:"图表标题 - 双击编辑",background:"背景",font:"字体",top:"上",right:"右",bottom:"下",left:"左",labels:"标签",size:"大小",minSize:"最小",maxSize:"最大",legend:"Legend",position:"位置",markerSize:"Marker Size",markerStroke:"Marker Stroke",markerPadding:"Marker Padding",itemSpacing:"Item Spacing",itemPaddingX:"Item Padding X",itemPaddingY:"Item Padding Y",layoutHorizontalSpacing:"Horizontal Spacing",layoutVerticalSpacing:"Vertical Spacing",strokeWidth:"Stroke Width",offset:"Offset",offsets:"Offsets",tooltips:"Tooltips",callout:"Callout",markers:"Markers",shadow:"Shadow",blur:"Blur",xOffset:"X Offset",yOffset:"Y Offset",lineWidth:"Line Width",normal:"Normal",bold:"Bold",italic:"Italic",boldItalic:"Bold Italic",predefined:"Predefined",fillOpacity:"Fill Opacity",strokeOpacity:"Line Opacity",histogramBinCount:"Bin count",columnGroup:"柱状",barGroup:"条形",pieGroup:"饼状",lineGroup:"线",scatterGroup:"散点及气泡",areaGroup:"面积",histogramGroup:"直方",groupedColumnTooltip:"Grouped",stackedColumnTooltip:"Stacked",normalizedColumnTooltip:"100% Stacked",groupedBarTooltip:"Grouped",stackedBarTooltip:"Stacked",normalizedBarTooltip:"100% Stacked",pieTooltip:"Pie",doughnutTooltip:"Doughnut",lineTooltip:"Line",groupedAreaTooltip:"Area",stackedAreaTooltip:"Stacked",normalizedAreaTooltip:"100% Stacked",scatterTooltip:"Scatter",bubbleTooltip:"Bubble",histogramTooltip:"Histogram",noDataToChart:"No data available to be charted.",pivotChartRequiresPivotMode:"Pivot Chart requires Pivot Mode enabled.",chartSettingsToolbarTooltip:"Menu",chartLinkToolbarTooltip:"Linked to Grid",chartUnlinkToolbarTooltip:"Unlinked from Grid",chartDownloadToolbarTooltip:"Download Chart",ariaHidden:"hidden",ariaVisible:"visible",ariaChecked:"checked",ariaUnchecked:"unchecked",ariaIndeterminate:"indeterminate",ariaColumnSelectAll:"Toggle Select All Columns",ariaInputEditor:"Input Editor",ariaDateFilterInput:"Date Filter Input",ariaFilterInput:"Filter Input",ariaFilterColumnsInput:"Filter Columns Input",ariaFilterValue:"Filter Value",ariaFilterFromValue:"Filter from value",ariaFilterToValue:"Filter to value",ariaFilteringOperator:"Filtering Operator",ariaColumnToggleVisibility:"column toggle visibility",ariaColumnGroupToggleVisibility:"column group toggle visibility",ariaRowSelect:"Press SPACE to select this row",ariaRowDeselect:"Press SPACE to deselect this row",ariaRowToggleSelection:"Press Space to toggle row selection",ariaRowSelectAll:"Press Space to toggle all rows selection",ariaSearch:"Search",ariaSearchFilterValues:"Search filter values"}};window.addEventListener("DOMContentLoaded",(function(){e.lk()}),!1);var a={version:"0.1.0",theme:"light",config:{autoFilterDatabaseNumber:40,selectDataLimit:200},typeDB:["SQLite","MySQL","MariaDB","Oracle","SQLServer","PostgreSQL"],iconDB:e=>["🖤","💚","🤎","💗","🧡","💙"][a.typeDB.indexOf(e)],typeEnv:["Development","Test","Production"],iconEnv:e=>["⚪","🔵","🔴"][a.typeEnv.indexOf(e)],icons:{id:"🆔",connType:"💞",connOrder:"🚩",connGroup:"👪",connEnv:"⚪",connConn:"🔗",connDatabase:"🎒",connTable:"📚",connColumn:"📙",loading:"🔄",ok:"🆗",generate:"🎲",ctrl:"🔧",copy:"👯",name:"📛",key:"🔑",edit:"✍",incr:"➚",comment:"📝",add:"➕",remove:"❌",info:"🔔",data:"🧮",cog:"⚙",clipboard:"📋"},iconGrid:function(e){return`<span class="ag-icon ag-icon-${e}"></span>`},resConnTemplate:{SQLite:"Data Source=<文件物理路径，或网络路径，后台自动下载文件>",MySQL:"Server=<IP>;Port=3306;Uid=<USER>;Pwd=<PWD>;Database=<DBNAME>;",MariaDB:"Server=<IP>;Port=3306;Uid=<USER>;Pwd=<PWD>;Database=<DBNAME>;",Oracle:"Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=<IP>)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=ORCL)));User Id=<USER>;Password=<PWD>;",SQLServer:"Server=<IP>,1433;User Id=<USER>;Password=<PWD>;Database=<DBNAME>;TrustServerCertificate=True;",PostgreSQL:"Server=<IP>;Port=5432;User Id=<USER>;Password=<PWD>;Database=<DBNAME>;"},resConnDemo:[{id:10001,type:"SQLite",alias:"SQLite:netnrf",group:"demo",order:1,env:"Test",conn:"Data Source=https://s1.netnr.eu.org/2020/05/22/2037505934.db"},{id:10002,type:"MySQL",alias:"Heroku JawsDB:ustf345c1n0wkaow",group:"demo",order:2,env:"Test",conn:"Server=c8u4r7fp8i8qaniw.chr7pe7iynqr.eu-west-1.rds.amazonaws.com;Port=3306;Uid=fyxnmvubyl01t2k9;Pwd=ai7a4eg3c31scfcm;Database=ustf345c1n0wkaow;"},{id:10003,type:"MariaDB",alias:"Heroku JawsDB:gvx25hgtxzfr2lia",group:"demo",order:3,env:"Test",conn:"Server=eporqep6b4b8ql12.chr7pe7iynqr.eu-west-1.rds.amazonaws.com;Port=3306;Uid=hydfd5qr08d3akt9;Pwd=tk53sieop5ua97pv;Database=gvx25hgtxzfr2lia;"},{id:10004,type:"SQLServer",alias:"SOMEE MSSQL:netnr-kit",group:"demo",order:5,env:"Test",conn:"Server=198.37.116.112,1433;User Id=netnr_SQLLogin_1;Password=o2y9vrbjac;Database=netnr-kit;TrustServerCertificate=True;"},{id:10005,type:"PostgreSQL",alias:"Heroku PostgreSQL:d7mhfq80unm96q",group:"demo",order:6,env:"Test",conn:"Server=ec2-54-74-35-87.eu-west-1.compute.amazonaws.com;Port=5432;User Id=psphnovbbmsgtj;Password=7554b25380195aa5755a24c7f6e1f9f94f3de3dcef9c345c7e93ae8b07699ace;Database=d7mhfq80unm96q;SslMode=Require;Trust Server Certificate=true;"}],resServer:[{host:"https://www.netnr.eu.org/api/v1",remark:"基于 Heroku 构建"},{host:location.origin,remark:"当前"}],_apiServer:location.origin,apiServer:"https://localhost:5001",apiHeaders:null,apiGetDatabaseName:"/DK/GetDatabaseName",apiGetDatabaseInfo:"/DK/GetDatabase",apiGetTable:"/DK/GetTable",apiGetColumn:"/DK/GetColumn",apiSetTableComment:"/DK/SetTableComment",apiSetColumnComment:"/DK/SetColumnComment",apiExecuteSql:"/DK/ExecuteSql",apiGetData:"/DK/GetData",apiGetDEI:"/DK/GetDEI"};window.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("*").forEach((e=>{if(e.classList.value.startsWith("nr-")){var t="dom";e.classList[0].substring(3).split("-").forEach((e=>t+=e.substring(0,1).toUpperCase()+e.substring(1))),a[t]=e}}))}),!1);var t={meConfig:e=>Object.assign({value:"",theme:"dark"==a.theme?"vs-dark":"vs",fontSize:18,language:"sql",automaticLayout:!0,scrollbar:{verticalScrollbarSize:13,horizontalScrollbarSize:13},minimap:{enabled:!0}},e),meCreate:(e,a)=>new Promise((n=>{n(monaco.editor.create(e,t.meConfig(a)))})),meFormatter:e=>e.trigger("a","editor.action.formatDocument"),meSelectedValue:e=>e.getModel().getValueInRange(e.getSelection()),meSelectedOrAllValue:e=>{var a=t.meSelectedValue(e);return""==a.trim()&&(a=e.getValue()),a},meFormatterSQL:function(e,a){var t;switch(a){case"MySQL":case"MariaDB":case"PostgreSQL":t=a.toLowerCase();break;case"Oracle":t="plsql";break;default:t="tsql"}return sqlFormatter.format(e,{language:t,uppercase:!0})}},n={sqlForSQLite:[{name:"库、表信息",sql:"select sqlite_version(); -- 版本\nPRAGMA database_list; -- 附加数据库\nPRAGMA encoding; -- 编码\n\nselect * from main.sqlite_master; -- 所有表信息、DDL\nPRAGMA table_info('SysButton'); -- 表信息\nselect cid, name, type, [notnull], quote(dflt_value) as dflt_value, pk from pragma_table_info('SysUser'); -- 表信息\n\nselect m.*, p.cid, p.name as colname, p.type as coltype, p.[notnull], quote(p.dflt_value) as dflt_value, p.pk\nfrom main.sqlite_master m left join pragma_table_info(m.name) p ON m.name<>p.name; -- 所有表信息\n"},{name:"时间函数",sql:"select '日期时间' as name, datetime() as value\nunion all\nselect '日期', date()\nunion all\nselect '时间', time()\nunion all\nselect '+2 天', date('now','+2 day')\nunion all\nselect '-2 年', date('now','-2 year')\nunion all\nselect '格式化（yyyy MM dd）', strftime('%Y %m %d','now')\nunion all\nselect '格式化（HH mm ss fff)', strftime('%H %M %S %s','now')"},{name:"内置命令",sql:"VACUUM; -- 磁盘空间释放\n\nselect hex(randomblob(16)); -- 模拟 UUID"},{name:"",sql:""}],sqlForMySQL:[{name:"show 常用",sql:"show databases; -- 显示数据库\nshow tables from information_schema; -- 显示当前数据库中所有表名称\nshow columns from information_schema.TABLES; -- 显示表中列名称\nshow table status; -- 显示表的信息\nshow index from information_schema.TABLES; -- 显示表索引\n\nshow grants for root; -- 显示用户权限\n\nshow status; -- 显示系统特定资源信息\nshow variables; -- 显示系统变量的名称和值\nshow variables like '%local_infile%'; -- 搜索\n\nshow processlist; -- 显示运行进程\n\nshow warnings; -- 显示最后的错误、警告和通知\nshow errors; -- 显示最后的错误\n\nshow slave status; -- 从状态\nshow master status; -- 主状态"},{name:"时间函数",sql:"select now(), sysdate(), sleep(1)\nunion all\nselect now(), sysdate(), 0; -- 当前日期时间，now 执行开始得到值 sysdate 实时获取\n\nselect concat('日期：',current_date(),' , 时间：',current_time()) '日期、时间' -- 日期、时间\nunion all\nselect concat('UTC日期：',utc_date(),' , UTC时间：',utc_time());\n\nselect utc_timestamp(); -- utc日期时间\nselect unix_timestamp(now()); -- 转时间戳\nselect date_format(now(), '%Y/%m/%d %H:%i:%s'); -- 格式化"},{name:"内置方法、对象",sql:"select uuid()"},{name:"",sql:""}],sqlForOracle:[{name:"管理、维护",sql:"-- sqlplus 连接数据库，密码请勿带 @ 符号，巨坑\nsqlplus system/oracle@(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(Host=localhost)(Port=1521))(CONNECT_DATA=(SID=orcl)))\n\n-- 查看表空间物理文件的名称及大小\nSELECT tablespace_name, file_id, file_name, round(bytes / (1024 * 1024), 0) total_space_MB FROM dba_data_files ORDER BY tablespace_name;\n\n-- 查询用户对应表空间\nselect username, default_tablespace from dba_users;\n-- 查看你能管理的所有用户\nselect * from all_users;\n-- 查看当前用户信息\nselect * from user_users;\n\n-- 创建表空间（大小 500M，每次 5M 自动增大，最大不限制）\n-- create tablespace DSPACE datafile '/u01/app/oracle/oradata/EE/DNAME.dbf' size 500M autoextend on next 5M maxsize unlimited;\n-- create tablespace DSPACE datafile 'c:oracleoradata\testDNAME.dbf' size 500M autoextend on next 5M maxsize unlimited;\n\n-- 删除表空间\n-- drop tablespace DSPACE including contents and datafiles cascade constraint;\n\n-- 创建用户并指定表空间\n-- create user DNAME identified by DPWD default tablespace DSPACE;\n\n-- 修改用户密码\nalter user DNAME identified by DPWD;\n\n-- 为用户指定表空间\nalter user DNAME default tablespace DSPACE;\n\n-- 删除用户\ndrop user DNAME cascade;\n\n-- 授予权限\n-- connect：授予最终用户的典型权利，最基本的\n-- resource：授予开发人员\n-- dba：授予数据库所有的权限\ngrant connect, resource to DNAME;\ngrant dba to DNAME;\n-- 撤销权限\nrevoke dba from DNAME;\n-- 查询用户授予的角色权限\nselect * from dba_role_privs where grantee='DNAME';\n\n-- 锁定用户\nalter user DNAME account lock;\n-- 解锁用户\nalter user DNAME account unlock;\n\n-- 账号过期查询\nSELECT username, account_status, expiry_date FROM dba_users;\n-- 密码过期策略\nSELECT * FROM dba_profiles WHERE profile='DEFAULT' AND resource_name='PASSWORD_LIFE_TIME';"},{name:"导入导出",sql:"-- 按用户导出\nexpdp system/oracle@orcl schemas=$user dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR\n-- 按表名导出\nexpdp system/oracle@orcl tables=($TABLE1,$TABLE2) dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR\n-- 按用户导入（表覆盖）\nimpdp system/oracle@orcl schemas=$user dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR table_exists_action=REPLACE\n-- 按用户导入（转换空间）\nimpdp system/oracle@orcl schemas=$user TRANSFORM=segment_attributes:n dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR table_exists_action=REPLACE\n\n-- 导入导出包权限设置\nchown oracle -R /u01/app/oracle/admin/EE/dpdump/\n\n-- DIRECTORY 参数说明\n-- 查看管理员目录\nselect * from dba_directories\n-- 创建逻辑目录，还需手动创建目录，Oracle 不关心目录是否存在，不存在会报错\ncreate directory DP_DIR as 'C:appAdministrator/admin/orcl/dpdump/'\n-- DUMPFILE 指定的 dmp 文件应放在 DIRECTORY 目录下\n-- 删除逻辑目录\ndrop directory DP_DIR"},{name:"内置方法、对象",sql:"select sysdate, sys_guid(), rawtohex(sys_guid()) from dual"},{name:"",sql:""}],sqlForSQLServer:[{name:"查看数据库信息",sql:"SELECT 'Name' col, SUBSTRING(@@VERSION, 1, CHARINDEX(' - ', @@VERSION, 1))+' '+CONVERT(varchar(99), SERVERPROPERTY('Edition')) val\nUNION ALL\nSELECT 'Version' col, SERVERPROPERTY('ProductVersion') val\nUNION ALL\nSELECT 'DirData' col, SERVERPROPERTY('InstanceDefaultDataPath') val\nUNION ALL\nSELECT 'CharSet' col, SERVERPROPERTY('Collation') val\nUNION ALL\nSELECT 'DateTime' col, GETDATE() val\nUNION ALL\nSELECT 'MaxConn' col, @@MAX_CONNECTIONS val\nUNION ALL\nSELECT 'CurrConn' col, (SELECT COUNT(dbid)FROM sys.sysprocesses) val\nUNION ALL\nSELECT 'IgnoreCase' col, (CASE WHEN 'a'='A' THEN 1 ELSE 0 END) val\nUNION ALL\nSELECT 'System' col, REPLACE(RIGHT(@@VERSION, CHARINDEX(CHAR(10), REVERSE(@@VERSION), 2)-2), CHAR(10), '') val"},{name:"远程查询超时",sql:"EXEC Sp_configure 'remote query timeout'"},{name:"执行脚本历史记录",sql:"SELECT QS.creation_time, SUBSTRING(ST.text, (QS.statement_start_offset / 2)+1, ((CASE QS.statement_end_offset WHEN-1 THEN DATALENGTH(st.text)ELSE QS.statement_end_offset END-QS.statement_start_offset)/ 2)+1) AS statement_text, ST.text, QS.total_worker_time, QS.last_worker_time, QS.max_worker_time, QS.min_worker_time\nFROM sys.dm_exec_query_stats QS\n     CROSS APPLY sys.dm_exec_sql_text(QS.sql_handle) ST\nWHERE ST.text LIKE '%%' AND QS.creation_time BETWEEN dateadd(MM, -1, GETDATE())AND GETDATE()\nORDER BY QS.creation_time DESC"},{name:"获取数据库名",sql:"SELECT name AS DatabaseName FROM sys.databases ORDER BY name"},{name:"表大小情况",sql:"-- 定义表变量\nDECLARE @T TABLE([name] VARCHAR(100),\n[rows] INT,\nreserved VARCHAR(100),\ndata_size VARCHAR(100),\nindex_size VARCHAR(100),\nunused VARCHAR(100));\n\n-- 将表占用情况存放到表变量\nINSERT INTO @T EXEC sp_MSforeachtable \"exec sp_spaceused '?'\";\nSELECT * FROM @T"},{name:"时间函数",sql:"declare @local datetime=getdate()\ndeclare @utc datetime=getutcdate()\ndeclare @utc8 datetime=dateadd(hour, 8, getutcdate())\nprint N'当前时间：'+CONVERT(varchar(100), @local, 21)\nprint N'UTC：'+CONVERT(varchar(100), @utc, 21)\nprint N'UTC +8：'+CONVERT(varchar(100), @utc8, 21)\nprint N'格式化（yyyy-MM-dd HH:mm:ss.fff）：'+CONVERT(varchar(100), @utc8, 21)\nprint N'格式化（yyyy-MM-dd HH:mm:ss）：'+CONVERT(varchar(100), @utc8, 20)\nprint N'格式化（yyyy-MM-dd）：'+CONVERT(varchar(100), @utc8, 23)\nprint N'格式化（yyyy.MM.dd）：'+CONVERT(varchar(100), @utc8, 102)\nprint N'格式化（yyyy/MM/dd）：'+CONVERT(varchar(100), @utc8, 111)\nprint N'格式化（yyyyMMdd）：'+CONVERT(varchar(100), @utc8, 112)\nprint N'格式化（HH:mm:ss）：'+CONVERT(varchar(100), @utc8, 24)\nprint N'追加一天：'+CONVERT(varchar(100), dateadd(day, 1, @utc8), 21)"},{name:"内置方法、对象",sql:"print NEWID()"},{name:"",sql:""}],sqlForPostgreSQL:[{name:"",sql:"SELECT\n  'Name' col,\n  split_part(split_part(VERSION(), ',', 1), ' on ', 1)\nUNION ALL\nSELECT\n  'Version' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'server_version'\n  ) val\nUNION ALL\nSELECT\n  'Compile' col,\n  split_part(VERSION(), ',', 2) val\nUNION ALL\nSELECT\n  'DirInstall' col,\n  (\n    SELECT\n      split_part(setting, 'main', 1)\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'archive_command'\n  ) val\nUNION ALL\nSELECT\n  'DirData' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'data_directory'\n  ) val\nUNION ALL\nSELECT\n  'CharSet' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'server_encoding'\n  ) val\nUNION ALL\nSELECT\n  'TimeZone' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'TimeZone'\n  ) val\nUNION ALL\nSELECT\n  'DateTime' col,\n  to_char(now(), 'YYYY-MM-DD HH24:MI:SS.MS') val\nUNION ALL\nSELECT\n  'MaxConn' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'max_connections'\n  ) val\nUNION ALL\nSELECT\n  'CurrConn' col,\n  CAST(COUNT(1) AS VARCHAR) val\nFROM\n  pg_stat_activity\nUNION ALL\nSELECT\n  'TimeOut' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'statement_timeout'\n  ) val\nUNION ALL\nSELECT\n  'IgnoreCase' col,\n  CASE\n    'a' = 'A'\n    WHEN 't' THEN '1'\n    ELSE '0'\n  END val\nUNION ALL\nSELECT\n  'System' col,\n  split_part(split_part(VERSION(), ',', 1), ' on ', 2) val\n"},{name:"���÷���������",sql:"DO $$\nBEGIN\n    RAISE NOTICE '��ǰ����ʱ�䣺%', now();\n    RAISE NOTICE '�汾��Ϣ��%', version();\n    RAISE NOTICE 'UUID��%', uuid_generate_v4(); -- create extension \"uuid-ossp\"; -- Ϊ��������չ\nEND;\n$$;\n"},{name:"",sql:""}]},o={dkStore:localforage.createInstance({name:"ndk"}),ccStore:localforage.createInstance({name:"ndk-cc"}),keyConns:"conns",keySteps:"steps",connsSet:e=>new Promise((a=>{o.connsGet().then((t=>{"Array"!=s.type(e)&&(e=[e]),e.forEach((e=>{for(var a=t.length-1;a>=0;a--)if(t[a].id==e.id){t.splice(a,1);break}})),t=t.concat(e),o.dkStore.setItem(o.keyConns,t).then((()=>a(t)))}))})),connsDelete:e=>new Promise((a=>{o.connsGet().then((t=>{for(var n=0;n<t.length;n++)if(t[n].id==e){t.splice(n,1);break}o.dkStore.setItem(o.keyConns,t).then((()=>a(t)))}))})),connsGet:e=>new Promise((a=>{o.dkStore.getItem(o.keyConns).then((t=>{t=t||[],a(null!=e?t.filter((a=>a.id==e)).pop()||[]:t)}))})),stepsSet:e=>o.dkStore.setItem(o.keySteps,e),stepsGet:()=>o.dkStore.getItem(o.keySteps),stepsDelete:()=>o.dkStore.removeItem(o.keySteps),cc:(e,a)=>new Promise((t=>{switch(e.length){case 1:e.splice(1,0,"database");break;case 2:e.splice(1,0,"table");break;default:e.splice(1,0,"column")}null==a?o.ccStore.getItem(e.join("-")).then((e=>t(e))):o.ccStore.setItem(e.join("-"),{data:a,date:Date.now()}).then((e=>t(e)))}))},r={tabKeys:{},tabOpen:(e,n,o)=>new Promise((i=>{if(!((e=`tp-${e}`)in r.tabKeys)){var l;l=`\n<div class="nr-spliter2 nrc-spliter-vertical">\n    \x3c!--SQL--\x3e\n    <div class="nr-editor-box nrc-spliter-item">\n        <div class="nr-editor-tool" panel="${e}">\n            <sl-tooltip content="执行选中或全部脚本（Ctrl + R）" placement="right">\n              <sl-icon-button data-cmd="sql-execute-selected" panel="${e}" name="caret-right-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="格式化脚本（Alt + Shift + F）" placement="right">\n              <sl-icon-button data-cmd="sql-formatting" panel="${e}" name="brush-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="常用脚本" placement="right">\n              <sl-icon-button data-cmd="sql-common" panel="${e}" name="journal-code" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n        </div>\n        <div class="nr-editor-sql" panel="${e}"></div>\n    </div>\n\n    <div class="nrc-spliter-bar"></div>\n    <div class="nrc-spliter-bar-active"></div>\n\n    \x3c!--Result--\x3e\n    <div class="nrc-spliter-item">\n        <sl-tab-group class="nr-tab-group-3">\n        </sl-tab-group>\n    </div>\n</div>\n                    `;var c=document.createElement("div");c.innerHTML=`\n<sl-tab slot="nav" panel="${e}" closable>${n}</sl-tab>\n<sl-tab-panel name="${e}">${l}</sl-tab-panel>\n            `;var d=c.querySelector("sl-tab"),m=c.querySelector("sl-tab-panel"),p=c.querySelector(".nr-editor-tool"),u=c.querySelector(".nr-editor-sql"),b=c.querySelector(".nr-tab-group-3");c.querySelector(".nrc-spliter-bar").addEventListener("mousedown",(function(e){var a=e.target.previousElementSibling,t=e.target.nextElementSibling,n=e.target.parentElement,o=a.clientHeight,r=function(a){var r=o-(e.clientY-a.clientY);r=Math.max(0,r),r=Math.min(n.clientHeight-t.clientHeight,r),t.style.display="block",t.style.top=`${r}px`},i=function(){t.style.display="none";var e=t.style.top;e.includes("%")||(e=(parseInt(t.style.top||a.clientHeight)/n.clientHeight*100).toFixed(4)+"%"),t.style.top=e,a.style.height=e,t.nextElementSibling.style.height=`calc(100% - var(--nrc-spliter-width) - ${e})`,s.size(),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i),this.releaseCapture&&this.releaseCapture()};window.addEventListener("mousemove",r,!1),window.addEventListener("mouseup",i,!1),this.setCapture&&this.setCapture()}),!1),c.querySelector(".nrc-spliter-bar").addEventListener("dblclick",(function(e){var a=(e.clientX-e.target.getBoundingClientRect().left)/e.target.clientWidth,t=e.target.previousElementSibling,n=e.target.nextElementSibling;a<.33333?(t.style.height="85%",n.style.top="85%",n.nextElementSibling.style.height="calc(100% - var(--nrc-spliter-width) - 85%)"):a>.33333&&a<.66666?(t.style.height="50%",n.style.top="50%",n.nextElementSibling.style.height="calc(100% - var(--nrc-spliter-width) - 50%)"):(t.style.height="15%",n.style.top="15%",n.nextElementSibling.style.height="calc(100% - var(--nrc-spliter-width) - 15%)"),s.size()}));var h=a.domTabGroup2.querySelectorAll("sl-tab-panel");a.domTabGroup2.insertBefore(d,h[0]),a.domTabGroup2.appendChild(m),r.tabNavFix(),c.remove(),r.tabKeys[e]={tpkey:e,type:o,domTab:d,domTabPanel:m,domEditorTool:p,domEditorSql:u,domTabGroup3:b},t.meCreate(u).then((a=>{r.tabKeys[e].editor=a,a.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyR,(function(){r.tabEditorExecuteSql(e)}))}))}setTimeout((()=>{a.domTabGroup2.show(e),i(e)}),10)})),tabEditorExecuteSql:e=>{var a=r.tabKeys[e],n=t.meSelectedOrAllValue(a.editor);if(""==n.trim())s.msg("执行 SQL 不能为空");else{var o=step.cpGet(e);db.reqExecuteSql(o.cobj,o.databaseName,n).then((a=>{db.viewExecuteSql(a,e)}))}},tabNavFix:()=>{document.body.style.zoom="1"==document.body.style.zoom?1.00001:1}},i={parameterJoin:e=>{var a=[];for(var t in e)a.push(`${t}=${encodeURIComponent(e[t])}`);return a.join("&")},request:(e,a)=>new Promise(((t,n)=>{s.requestStatus(!0),fetch(e,Object.assign({method:"GET"},a)).then((e=>e.json())).then((e=>{console.warn(e),s.requestStatus(!1),200==e.code?t(e):(s.msg(e.msg),n(e))})).catch((e=>{s.confirm(e),s.requestStatus(!1),n(e)}))})),createGrid:(e,t)=>{i.removeGrid(e);var n=`gridOps${e=s.fu(e)}`,o=`domGrid${e}`;s.themeGrid(a.theme),s.size(),a[n]=new agGrid.Grid(a[o],t).gridOptions},removeGrid:e=>{var t=`gridOps${e=s.fu(e)}`;a[t]&&a[t].api&&(a[`domFilter${e}`].value="",a[t].api.destroy(),a[t]=null)},reqConns:()=>new Promise((e=>{o.connsGet().then((t=>{0==t.length&&(t=a.resConnDemo),t.sort(((e,a)=>e.order-a.order)),e(t)}))})),viewConns:t=>new Promise((n=>{var c=e.optionDef({rowData:t,getRowNodeId:e=>e.id,defaultColDef:e.defaultColDef({editable:!0}),columnDefs:[{field:"id",headerName:a.icons.id,width:150,editable:!1,checkboxSelection:!0,headerCheckboxSelection:!0},{field:"alias",headerName:a.icons.connConn+"连接名",width:350,rowDrag:!0},{field:"type",headerName:a.icons.connType+"类型",enableRowGroup:!0,width:160,cellRenderer:e=>e.value?a.iconDB(e.value)+e.value:"",cellEditor:"agRichSelectCellEditor",cellEditorParams:{values:a.typeDB,formatValue:e=>a.iconDB(e)+e}},{field:"group",headerName:a.icons.connGroup+"分组",width:160,enableRowGroup:!0},{field:"env",headerName:a.icons.connEnv+"环境",width:160,enableRowGroup:!0,cellRenderer:e=>e.value?a.iconEnv(e.value)+e.value:"",cellEditor:"agRichSelectCellEditor",cellEditorParams:{values:a.typeEnv,formatValue:e=>a.iconEnv(e)+e}},{field:"order",headerName:a.icons.connOrder+"排序"},{field:"conn",headerName:a.icons.connConn+"连接字符串",width:600,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{headerName:a.icons.ctrl+"操作",pinned:"right",width:100,hide:!0,filter:!1,sortable:!1,editable:!1,menuTabs:!1,cellRenderer:class{init(e){this.eGui=document.createElement("div"),e.data&&(this.eGui.innerHTML='\n                                <a href="javascript:void(0);" class="text-decoration-none nr-conn-cell-add" title="新增">➕</a> &nbsp;\n                                <a href="javascript:void(0);" class="text-decoration-none nr-conn-cell-del" title="删除">❌</a>\n                               ',this.eGui.addEventListener("click",(function(t){var n=t.target;if(n.classList.contains("nr-conn-cell-add")){var r={...e.data};r.id=s.random(2e4,99999),r.alias+="+",a.gridOpsConns.api.applyTransaction({add:[r],addIndex:e.rowIndex+1}),o.connsSet(r)}else n.classList.contains("nr-conn-cell-del")&&confirm("确定删除？")&&(a.gridOpsConns.api.applyTransaction({remove:[e.data]}),o.connsDelete(e.data.id))}),!1))}getGui(){return this.eGui}}}],autoGroupColumnDef:e.autoGroupColumnDef(),rowDragManaged:!0,rowDragMultiRow:!0,onRowDragEnd:function(e){var a=[],t=1;e.api.forEachNode((e=>{var n=e.data;n.order=t++,a.push(n)})),e.api.applyTransaction({update:a}),o.connsSet(a)},onCellValueChanged:function(){o.connsSet(e.getAllRows(a.gridOpsConns,!0))},onCellDoubleClicked:function(e){"id"==e.colDef.field&&(l.cpGet(1).cobj.id!=e.node.data.id&&(["database","table","column"].forEach((e=>i.removeGrid(e))),l.cpInfo(1)),l.cpSet(1,e.node.data),i.reqDatabaseName(e.node.data).then((e=>{i.viewDatabase(e).then((()=>{l.cpInfo(1),a.domTabGroup1.show("tp1-database")}))})))},getContextMenuItems:t=>{var n=t.node,c=n?.data,d=[];a.typeDB.forEach((t=>{d.push({name:t,icon:a.iconDB(t),action:function(){var r=n?n.rowIndex+1:e.getAllRows(a.gridOpsConns,!0).length,i={id:s.random(2e4,99999),type:t,alias:"alias",group:"default",order:r+1,env:a.typeEnv[0],conn:a.resConnTemplate[t]};a.gridOpsConns.api.applyTransaction({add:[i],addIndex:r}),o.connsSet(i)}})}));var m=[];a.resConnDemo.forEach((t=>{m.push({name:t.alias,icon:a.iconDB(t.type),action:function(){var n=e.getAllRows(a.gridOpsConns,!0);if(n.filter((e=>e.id==t.id)).length){var r=a.gridOpsConns.api.getRowNode(t.id);a.gridOpsConns.api.ensureIndexVisible(r.rowIndex),a.gridOpsConns.api.flashCells({rowNodes:[r]})}else{var i=t;i.order=n.length+1,a.gridOpsConns.api.applyTransaction({add:[i],addIndex:n.length}),o.connsSet(i)}}})}));var p=[{name:"新建查询",icon:a.icons.comment,disabled:null==c,action:function(){r.tabOpen(s.random(),a.icons.connConn+c.alias,"sql").then((e=>{l.cpSet(e,c),l.cpInfo(e)}))}},"separator",{name:"打开连接",icon:a.icons.connDatabase,disabled:null==c,action:function(){l.cpGet(1).cobj.id!=t.node.data.id&&["database","table","column"].forEach((e=>i.removeGrid(e))),l.cpSet(1,t.node.data),i.reqDatabaseName(t.node.data).then((e=>{i.viewDatabase(e).then((()=>{l.cpInfo(1),a.domTabGroup1.show("tp1-database")}))}))}},{name:"创建连接",icon:a.icons.connConn,subMenu:d},{name:"示例连接",subMenu:m},{name:"编辑连接",icon:a.icons.edit,disabled:null==c,action:function(){t.api.startEditingCell({rowIndex:t.node.rowIndex,colKey:t.column.colId})}},{name:"复制连接",icon:a.iconGrid("copy"),disabled:null==c,action:function(){var e={...t.node.data};e.id=s.random(),e.alias+="+",a.gridOpsConns.api.applyTransaction({add:[e],addIndex:t.node.rowIndex+1}),o.connsSet(e)}},{name:"删除连接",icon:a.icons.remove,disabled:null==c,subMenu:[{name:"确定",icon:a.icons.ok,action:function(){a.gridOpsConns.api.applyTransaction({remove:[c]}),o.connsDelete(c.id)}}]},{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},"separator",{name:"刷新",icon:a.icons.loading,action:function(){i.reqConns().then((e=>{i.viewConns(e)}))}},"autoSizeAll","resetColumns","separator","copy","copyWithHeaders"];return p}});i.createGrid("conns",c),n()})),reqDatabaseName:(e,t=!1)=>new Promise(((n,r)=>{new Promise((a=>{t?a():o.cc([e.id]).then((e=>{null!=e?a(e.data):a()})).catch((()=>a()))})).then((t=>{if(t)n(t);else{var l=i.parameterJoin({tdb:e.type,conn:e.conn});i.request(`${a.apiServer}${a.apiGetDatabaseName}?${l}`).then((a=>{var t=[];a.data.forEach((e=>{t.push({DatabaseName:e})})),o.cc([e.id],t),n(t)})).catch((e=>r(e)))}}))})),reqDatabaseInfo:(e,t,n=!1)=>new Promise(((r,l)=>{var s=""==t?[]:t.split(",");new Promise((a=>{n?a():o.cc([e.id]).then((e=>{if(null!=e){var t=!0;e.data.forEach((e=>{0==s.length?Object.hasOwnProperty.call(e,"DatabaseClassify")||(t=!1):s.includes(e.DatabaseName)&&!Object.hasOwnProperty.call(e,"DatabaseClassify")&&(t=!1)})),t?a(e.data):a()}else a()})).catch((()=>a()))})).then((n=>{if(n)r(n);else{var s=i.parameterJoin({tdb:e.type,conn:e.conn,filterDatabaseName:t});i.request(`${a.apiServer}${a.apiGetDatabaseInfo}?${s}`).then((a=>{o.cc([e.id]).then((t=>{t.data.forEach((e=>{var t=a.data.filter((a=>a.DatabaseName==e.DatabaseName));t.length>0&&Object.assign(e,t[0])})),o.cc([e.id],t.data),r(t.data)}))})).catch((e=>l(e)))}}))})),viewDatabase:t=>new Promise((n=>{var o=e.optionDef({rowData:t,getRowNodeId:e=>e.DatabaseName,columnDefs:[{headerName:"数据库信息",children:[{headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1},{field:"DatabaseName",headerName:a.icons.connDatabase+"库名",width:350},{field:"DatabaseClassify",headerName:"类别",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseOwner",headerName:"所属者",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseSpace",headerName:"表空间",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseCharset",headerName:"字符集",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseCollation",headerName:"排序规则",width:180,enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseDataLength",headerName:"数据大小",columnGroupShow:"open",cellRenderer:e=>e.value>0?s.formatByteSize(e.value):""},{field:"DatabaseLogLength",headerName:"日志大小",columnGroupShow:"open",cellRenderer:e=>e.value>0?s.formatByteSize(e.value):""},{field:"DatabaseIndexLength",headerName:"索引大小",columnGroupShow:"open",cellRenderer:e=>e.value>0?s.formatByteSize(e.value):""},{field:"DatabasePath",headerName:"库路径",width:400,columnGroupShow:"open"},{field:"DatabaseLogPath",headerName:"日志路径",width:400,columnGroupShow:"open"},{field:"DatabaseCreateTime",headerName:"创建时间",width:200,columnGroupShow:"open"}]}],autoGroupColumnDef:e.autoGroupColumnDef(),onRowDoubleClicked:function(e){if(!e.node.group){var t=l.cpGet(1);l.cpSet(1,t.cobj,e.node.data.DatabaseName),i.reqTable(t.cobj,e.node.data.DatabaseName).then((e=>{i.viewTable(e,t.cobj).then((()=>{l.cpInfo(1),a.domTabGroup1.show("tp1-table")}))}))}},onColumnGroupOpened:function(t){if(t.columnGroup.expanded){var n=t.api.getSelectedRows();if(0==n.length)for(var o=t.api.getFirstDisplayedRow(),r=t.api.getLastDisplayedRow(),s=o;s<=r;s++){var c=t.api.getDisplayedRowAtIndex(s);n.push(c.data)}else e.getAllRows(a.gridOpsDatabase).length==n.length&&(n=[]);var d=l.cpGet(1);i.reqDatabaseInfo(d.cobj,n.map((e=>e.DatabaseName)).join(",")).then((e=>{a.gridOpsDatabase.api.applyTransactionAsync({update:e})}))}},getContextMenuItems:e=>{var t=e.node?e.node.data:null,n=[{name:"新建查询",icon:a.icons.comment,disabled:null==t,action:function(){r.tabOpen(s.random(),a.icons.connDatabase+t.DatabaseName,"sql").then((e=>{var a=l.cpGet(1);l.cpSet(e,a.cobj,t.DatabaseName),l.cpInfo(e)}))}},"separator",{name:"打开数据库",icon:a.icons.connTable,disabled:null==t,action:function(){var e=l.cpGet(1);l.cpSet(1,e.cobj,t.DatabaseName),i.reqTable(e.cobj,t.DatabaseName).then((t=>{i.viewTable(t,e.cobj).then((()=>{l.cpInfo(1),a.domTabGroup1.show("tp1-table")}))}))}},{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},{name:"导入",icon:a.iconGrid("asc"),action:function(){}},"separator",{name:"刷新",icon:a.icons.loading,action:function(){var e=l.cpGet(1);i.reqDatabaseName(e.cobj,!0).then((e=>{i.viewDatabase(e)}))}},"autoSizeAll","resetColumns","separator","copy","copyWithHeaders"];return n}});if(i.createGrid("database",o),t.length>a.config.autoFilterDatabaseNumber){var c,d=l.cpGet(1),m="Oracle"==d.cobj.type?"user id=":"database=",p=d.cobj.conn.split(";").filter((e=>e.toLowerCase().startsWith(m)));p.length&&(c=p[0].split("=").pop(),a.gridOpsDatabase.api.setFilterModel({DatabaseName:{type:"set",values:[c]}}))}n()})),reqTable:(e,t,n=!1)=>new Promise(((r,l)=>{new Promise((a=>{n?a():o.cc([e.id,t]).then((e=>{null!=e?a(e.data):a()})).catch((()=>a()))})).then((n=>{if(n)r(n);else{var s=i.parameterJoin({tdb:e.type,conn:e.conn,databaseName:t});i.request(`${a.apiServer}${a.apiGetTable}?${s}`).then((a=>{o.cc([e.id,t],a.data),r(a.data)})).catch((e=>l(e)))}}))})),viewTable:(t,n)=>new Promise((o=>{var d="SQLite"==n.type,m="SQLServer"==n.type,p=e.optionDef({rowData:t,getRowNodeId:e=>e.TableName,rowGroupPanelShow:"never",columnDefs:[{headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1},{field:"TableName",tooltipField:"TableName",headerName:a.icons.connTable+"表名",width:350,cellRenderer:e=>m?`${e.data.TableSchema}.${e.value}`:e.value},{field:"TableComment",tooltipField:"TableComment",headerName:a.icons.comment+"表注释",width:290,hide:d,editable:!d,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{field:"TableRows",headerName:"行数"},{field:"TableDataLength",headerName:"数据大小",width:160,cellRenderer:e=>s.formatByteSize(e.value)},{field:"TableIndexLength",headerName:"索引大小",width:160,cellRenderer:e=>s.formatByteSize(e.value)},{field:"TableCollation",headerName:"字符集",width:180},{field:"TableCreateTime",headerName:"创建时间",width:220},{field:"TableModifyTime",headerName:"修改时间",width:220},{field:"TableSchema",headerName:"Schema"},{field:"TableType",headerName:"分类"}],onCellDoubleClicked:function(e){if("TableComment"!=e.column.colId){var t=l.cpGet(1);l.cpSet(1,t.cobj,t.databaseName,e.node.data.TableName),i.reqColumn(t.cobj,t.databaseName,e.node.data.TableName).then((e=>{i.viewColumn(e,t.cobj).then((()=>{l.cpInfo(1),a.domTabGroup1.show("tp1-column")}))}))}},onCellValueChanged:function(e){if("TableComment"==e.column.colId){var a=l.cpGet(1);i.setTableComment(a.cobj,a.databaseName,e.data.TableName,e.value).then((()=>{}))}},getContextMenuItems:t=>{var n=t.node?t.node.data:null,o=[{name:"表设计",disabled:null==t.node?.data,icon:a.iconGrid("columns"),action:function(){t.node.isSelected()||t.node.setSelected(!0);var n=a.gridOpsTable.api.getSelectedRows(),o="";e.getAllRows(a.gridOpsTable).length!=n.length&&(o=n.map((e=>e.TableName)).join(","));var r=l.cpGet(1);l.cpSet(1,r.cobj,r.databaseName,o),i.reqColumn(r.cobj,r.databaseName,o).then((e=>{i.viewColumn(e,r.cobj).then((()=>{l.cpInfo(1),a.domTabGroup1.show("tp1-column")}))}))}},{name:"表数据",icon:a.iconGrid("grip"),disabled:null==t.node?.data,tooltip:"查询表数据",action:function(){t.api.deselectAll(),t.node.setSelected(!0),r.tabOpen(s.random(),a.icons.connTable+n.TableName,"sql").then((e=>{var a=r.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var t=l.cpGet(1);l.cpSet(e,t.cobj,t.databaseName,n.TableName),l.cpInfo(e);var o=l.cpGet(e),i=c.buildSqlSelect(o,n);i=me.meFormatterSQL(i,t.cobj.type),a.editor.setValue(i),r.tabEditorExecuteSql(e)}))}},{name:"生成 SQL",icon:a.icons.generate,disabled:null==t.node?.data,subMenu:[{name:"SELECT",icon:a.iconGrid("paste"),action:function(){r.tabOpen(s.random(),a.icons.connTable+n.TableName,"sql").then((e=>{var a=r.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var t=l.cpGet(1);l.cpSet(e,t.cobj,t.databaseName,n.TableName),l.cpInfo(e),i.reqColumn(t.cobj,t.databaseName,n.TableName,!0).then((o=>{var r=l.cpGet(e),i=c.buildSqlSelect(r,n,o);i=me.meFormatterSQL(i,t.cobj.type),a.editor.setValue(i)}))}))}},{name:"INSERT",icon:a.iconGrid("paste"),action:function(){r.tabOpen(s.random(),a.icons.connTable+n.TableName,"sql").then((e=>{var a=r.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var t=l.cpGet(1);l.cpSet(e,t.cobj,t.databaseName,n.TableName),l.cpInfo(e),i.reqColumn(t.cobj,t.databaseName,n.TableName,!0).then((o=>{var r=l.cpGet(e),i=c.buildSqlInsert(r,n,o);i=me.meFormatterSQL(i,t.cobj.type),a.editor.setValue(i)}))}))}},{name:"UPDATE",icon:a.iconGrid("paste"),action:function(){r.tabOpen(s.random(),a.icons.connTable+n.TableName,"sql").then((e=>{var a=r.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var t=l.cpGet(1);l.cpSet(e,t.cobj,t.databaseName,n.TableName),l.cpInfo(e),i.reqColumn(t.cobj,t.databaseName,n.TableName,!0).then((o=>{var r=l.cpGet(e),i=c.buildSqlUpdate(r,n,o);i=me.meFormatterSQL(i,t.cobj.type),a.editor.setValue(i)}))}))}},{name:"DELETE",icon:a.iconGrid("paste"),action:function(){r.tabOpen(s.random(),a.icons.connTable+n.TableName,"sql").then((e=>{var a=r.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var t=l.cpGet(1);l.cpSet(e,t.cobj,t.databaseName,n.TableName),l.cpInfo(e),i.reqColumn(t.cobj,t.databaseName,n.TableName,!0).then((o=>{var r=l.cpGet(e),i=c.buildSqlDelete(r,n,o);i=me.meFormatterSQL(i,t.cobj.type),a.editor.setValue(i)}))}))}},{name:"TRUNCATE",icon:a.iconGrid("paste"),action:function(){}},{name:"DROP",icon:a.iconGrid("paste"),action:function(){}},"separator",{name:"结构 DDL",icon:a.iconGrid("paste"),action:function(){}},{name:"结构和数据",icon:a.iconGrid("paste"),action:function(){}}]},{name:"导出",icon:a.iconGrid("desc"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},{name:"导入",icon:a.iconGrid("asc")},"separator",{name:"刷新",icon:a.icons.loading,action:function(){var e=l.cpGet(1);i.reqTable(e.cobj,e.databaseName,!0).then((a=>{i.viewTable(a,e.cobj)}))}},"autoSizeAll","resetColumns","separator","copy","copyWithHeaders"];return o}});i.createGrid("table",p),o()})),setTableComment:(e,t,n,o)=>new Promise(((r,l)=>{var s=new FormData;s.append("tdb",e.type),s.append("conn",e.conn),s.append("tableName",n),s.append("tableComment",o),s.append("databaseName",t),i.request(`${a.apiServer}${a.apiSetTableComment}`,{method:"POST",body:s}).then((e=>r(e))).catch((e=>l(e)))})),reqColumn:(e,t,n,r=!1)=>new Promise(((l,s)=>{new Promise((a=>{r?a():o.cc([e.id,t,"*"]).then((e=>{if(null!=e)if(null!=n&&""!=n){var t=e.data.map((e=>e.TableName)),o=n.split(",");if(o.filter((e=>!t.includes(e))).length)a();else{var r=e.data.filter((e=>o.includes(e.TableName)));a(r)}}else a(e.data);else a()})).catch((()=>a()))})).then((r=>{if(r)l(r);else{var c=new FormData;c.append("tdb",e.type),c.append("conn",e.conn),c.append("filterTableName",n),c.append("databaseName",t),i.request(`${a.apiServer}${a.apiGetColumn}`,{method:"POST",body:c}).then((a=>{o.cc([e.id,t,"*"]).then((n=>{if(null!=n){var r=a.data.map((e=>e.TableName)),i=n.data.filter((e=>!r.includes(e.TableName)));i=i.concat(a.data).sort(((e,a)=>e.TableName.localeCompare(a.TableName))),o.cc([e.id,t,"*"],i)}else o.cc([e.id,t,"*"],a.data)})),l(a.data)})).catch((e=>s(e)))}}))})),viewColumn:(t,n)=>new Promise((o=>{var r="SQLite"==n.type,s=e.optionDef({rowData:t,getRowNodeId:e=>e.ColumnName,groupSelectsChildren:!0,columnDefs:[{headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1,hide:!0},{field:"TableName",headerName:a.icons.connTable+"表名",rowGroup:!0,enableRowGroup:!0,width:350,hide:!0},{field:"TableComment",headerName:a.icons.connTable+"表注释",width:300,hide:!0},{field:"ColumnName",headerName:a.icons.connColumn+"列名",width:200,hide:!0},{field:"ColumnComment",tooltipField:"ColumnComment",headerName:a.icons.comment+"列注释",width:330,hide:r,editable:!r,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{field:"ColumnType",headerName:"类型及长度",width:150,hide:!0},{field:"DataType",headerName:"类型",width:120,hide:!0},{field:"DataLength",headerName:"长度",hide:!0},{field:"DataScale",headerName:"精度",hide:!0},{field:"ColumnOrder",headerName:"列序"},{field:"PrimaryKey",headerName:"主键",hide:!0,cellRenderer:e=>e.value>0?a.icons.key+e.value:""},{field:"AutoIncr",headerName:"自增",cellRenderer:e=>1==e.value?a.icons.incr:""},{field:"IsNullable",headerName:"必填",hide:!0,cellRenderer:e=>1==e.value?"":a.icons.edit},{field:"ColumnDefault",headerName:"默认值",width:120}],autoGroupColumnDef:e.autoGroupColumnDef({field:"ColumnName",headerName:"分组",width:560,headerCheckboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,filterValueGetter:e=>e.data.TableName,cellRendererParams:{checkbox:!0,suppressCount:!0,suppressEnterExpand:!0,suppressDoubleClickExpand:!0,innerRenderer:function(e){if(e.node.group){var t=a.gridOpsColumn.rowData.filter((a=>a[e.node.field]==e.value));return`<b>${e.value} (${t.length}) </b> <span class="badge bg-secondary mx-2" role="button">数据</span> <span title="${t[0].TableComment||""}">${t[0].TableComment||""}</span>`}var n=[];return e.data.PrimaryKey>0&&n.push(a.icons.key+e.data.PrimaryKey),n.push(e.data.ColumnType),1==e.data.IsNullable?n.push("null"):n.push("not null"),`${e.value} <span class="opacity-75">( ${n.join(", ")} )</span>`}}}),onCellValueChanged:function(e){if("ColumnComment"==e.column.colId){var a=l.cpGet(1);i.setColumnComment(a.cobj,a.databaseName,e.data.TableName,e.data.ColumnName,e.value).then((()=>{}))}},getContextMenuItems:e=>{var t=[{name:"Alert "+e.value,action:function(){window.alert("Alerting at "+e.value)},cssClasses:["redFont","bold"]},{name:"Always Disabled",disabled:!0,tooltip:"Very long tooltip, did I mention that I am very long, well I am! Long!  Very Long!"},{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},"expandAll","contractAll","separator",{name:"刷新",icon:a.icons.loading,action:function(){var e=l.cpGet(1);i.reqColumn(e.cobj,e.databaseName,e.tableName,!0).then((a=>{i.viewColumn(a,e.cobj)}))}},"autoSizeAll","resetColumns","separator","copy","copyWithHeaders"];return t}});i.createGrid("column",s),setTimeout((()=>{a.gridOpsColumn.api.forEachNode((e=>{0==e.level&&e.setExpanded(!0)}))}),300),o()})),setColumnComment:(e,t,n,o,r)=>new Promise(((l,s)=>{var c=new FormData;c.append("tdb",e.type),c.append("conn",e.conn),c.append("tableName",n),c.append("columnName",o),c.append("columnComment",r),c.append("databaseName",t),i.request(`${a.apiServer}${a.apiSetColumnComment}`,{method:"POST",body:c}).then((e=>l(e))).catch((e=>s(e)))})),reqExecuteSql:(e,t,n)=>new Promise(((o,r)=>{var l=new FormData;l.append("tdb",e.type),l.append("conn",e.conn),l.append("sql",n),t&&l.append("databaseName",t),i.request(`${a.apiServer}${a.apiExecuteSql}`,{method:"POST",body:l}).then((e=>{o(e.data)})).catch((e=>r(e)))})),viewExecuteSql:(t,n)=>new Promise((o=>{var i=r.tabKeys[n];i.grids&&i.grids.forEach((e=>e.gridOps&&e.gridOps.api.destroy())),i.grids=[],i.domTabGroup3.innerHTML="",i.domTabGroup3.getAttribute("data-bind")||(i.domTabGroup3.setAttribute("data-bind",!0),i.domTabGroup3.addEventListener("sl-close",(async e=>{var a=e.target,t=i.domTabGroup3.querySelector(`sl-tab-panel[name="${a.panel}"]`);if(a.active){var n=a.previousElementSibling||a.nextElementSibling;n.nodeName!="sl-tab-panel".toUpperCase()&&i.domTabGroup3.show(n.panel)}a.remove(),t.remove(),r.tabNavFix();for(var o=0;o<i.grids.length;o++)if(i.grids[o].tpkey==a.panel){i.grids.splice(o,1);break}e.stopPropagation()})),i.domTabGroup3.addEventListener("sl-tab-show",(function(e){setTimeout((()=>{s.size()}),1)}),!1)),new Promise((n=>{for(const n in t)if("Item2"!=n){var o=0;for(const r in t[n]){var l=t[n][r],c=[],d="Item1"==n?a.icons.data+"Result":a.icons.info+"Info",m=`tp3-${n}-${o}`;0!=o&&(d+=" - "+o);var p=document.createElement("div");p.innerHTML=`\n<sl-tab slot="nav" panel="${m}" closable>${d}</sl-tab>\n<sl-tab-panel name="${m}">\n    <sl-input class="nr-filter-execute-sql mb-2" placeholder="搜索" size="small"></sl-input>\n    <div class="nr-grid-execute-sql"></div>\n</sl-tab-panel>\n                `;var u=p.querySelector("sl-tab"),b=p.querySelector("sl-tab-panel"),h=p.querySelector(".nr-filter-execute-sql"),g=p.querySelector(".nr-grid-execute-sql"),v=i.domTabGroup3.querySelectorAll("sl-tab-panel");if(i.domTabGroup3.insertBefore(u,v[0]),i.domTabGroup3.appendChild(b),p.remove(),l.length>0){"Item1"==n&&c.push({headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1});var S=l[0];for(var f in S)c.push({field:f,headerName:f,headerTooltip:f,enableRowGroup:!0})}else if(r in(t.Item2||{}))for(const e in t.Item2[r]){var E=t.Item2[r][e];c.push({headerName:E.ColumnName,field:E.ColumnName,headerTooltip:f})}var y=e.optionDef({rowData:l,columnDefs:c,getContextMenuItems:e=>["copy","copyWithHeaders",{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},{name:"生成 SQL",icon:a.icons.generate,subMenu:[{name:"INSERT",icon:a.iconGrid("paste"),action:function(){}},{name:"UPDATE",icon:a.iconGrid("paste"),action:function(){}},{name:"DELETE",icon:a.iconGrid("paste"),action:function(){}}]},"separator","autoSizeAll","resetColumns","separator","chartRange"],onGridReady:function(e){e.columnApi.autoSizeAllColumns(),s.size()}});"Item1"!=n&&(y.rowGroupPanelShow="never",y.headerHeight=0,y.getContextMenuItems=()=>["copy","csvExport","excelExport","separator","autoSizeAll","resetColumns"]),i.grids.push({tpkey:m,domTab:u,domTabPanel:b,domFilterExecuteSql:h,domGridExecuteSql:g,opsExecuteSql:y}),o++}}setTimeout((()=>{r.tabNavFix(),2==i.grids.length&&0==i.grids[0].opsExecuteSql.columnDefs.length?i.domTabGroup3.show(i.grids[1].tpkey):i.domTabGroup3.show(i.grids[0].tpkey),n()}),10)})).then((()=>{s.themeGrid(a.theme),s.size(),o(t)}))}))},l={"cp-1":{cobj:{},databaseName:null,tableName:null},cpKeys:["1"],cpGet:e=>l[`cp-${e}`],cpSet:(e,a,t,n)=>{l.cpKeys.includes(e)||l.cpKeys.push(e),l[`cp-${e}`]={cobj:a,databaseName:t,tableName:n},l.stepSave()},cpRemove:e=>{var a=l.cpKeys.indexOf(e);a>=0&&l.cpKeys.splice(a,1),delete l[`cp-${e}`],l.stepSave()},cpInfo:e=>{if("reset"==e)a.domWindowConns.style.display="none",a.domWindowDatabase.style.display="none",a.domWindowConns.innerHTML="",a.domWindowDatabase.innerHTML="";else{var t=l.cpGet(e);if(null!=t){var n=t.cobj;if(1==e){var o=`${a.iconDB(n.type)} ${n.type} ${a.icons.connConn} ${n.alias} ${a.iconEnv(n.env)} ${n.env} ${null==t.databaseName?"":a.icons.connDatabase+" "+t.databaseName}\n${a.icons.connConn} ${n.conn}`;["database","table","column"].forEach((e=>{a.domTabGroup1.querySelector(`[panel="tp1-${e}"]`).title=o}))}else a.domWindowConns.style.display="block",a.domWindowDatabase.style.display="block",a.domWindowConns.innerHTML=`<sl-menu-item value="${n.id}">${a.iconDB(n.type)+n.alias+a.iconEnv(n.env)}</sl-menu-item>`,a.domWindowConns.value=n.id+"",t.databaseName?a.domWindowDatabase.innerHTML=`<sl-menu-item>${a.icons.connDatabase+t.databaseName}</sl-menu-item>`:a.domWindowDatabase.innerHTML="<sl-menu-item>（none）</sl-menu-item>"}}},stepVarIng:0,stepVarStart:Date.now(),stepVarEnd:Date.now(),stepVarIndex:0,stepVarDefer:null,stepStatus:e=>{switch(e){case 1:l.stepVarStart=Date.now(),l.stepVarIng=e,l.stepVarIndex=0;break;case 2:l.stepVarEnd=Date.now(),l.stepVarIng=e,console.warn("step done "+(l.stepVarEnd-l.stepVarStart)),clearTimeout(l.stepVarDefer);break;default:l.stepVarEnd=Date.now(),l.stepVarIng=-1,console.warn("step timeout")}},stepSave:()=>{if(1!=l.stepVarIng){var e={theme:a.theme,box1Size:s.cssvar(a.domMain,"--box1-width"),connCache:{},tabGroup1Show:"tp-conns",viewDatabase:null!=a.gridOpsDatabase,viewTable:null!=a.gridOpsTable,viewColumn:null!=a.gridOpsColumn};a.domTabGroup1.querySelectorAll("sl-tab-panel").forEach((a=>{"block"==a.style.display&&(e.tabGroup1Show=a.name)})),e.connCache[1]=l.cpGet(1)||{},e.loadTable&&(e.selectedTable=a.gridOpsTable.api.getSelectedRows().map((e=>e.TableName))),e.loadColumn&&(e.selectedColumn=a.gridOpsColumn.api.getSelectedRows().map((e=>e.TableName+":"+e.ColumnName))),o.stepsSet(e)}},stepStart:()=>new Promise((e=>{1==l.stepVarIng?s.msg("正在进行中..."):(l.stepStatus(1),l.stepVarDefer=setTimeout((()=>{l.stepStatus(-1),e()}),3e4),o.stepsGet().then((a=>l.stepItemRun(["step-theme","step-box1-size","step-conn-cache","step-view-conns","step-tab-group1-show"],a).then((()=>l.stepItemRun(["step-view-database","step-view-table","step-view-column"],a).then((()=>{l.stepStatus(2),e()})))))))})),stepItemRun:(e,a)=>new Promise((t=>{var n=[];e.forEach((e=>n.push(l.stepItemCmd(e,a)))),Promise.all(n).then((()=>t())).catch((()=>t()))})),stepItemCmd:(e,t)=>new Promise((n=>{switch(t=t||{},e){case"step-theme":s.actionRun("dark"==t.theme?"theme-dark":"theme-light"),n();break;case"step-box1-size":t.box1Size&&""!=t.box1Size&&s.cssvar(a.domMain,"--box1-width",t.box1Size),n();break;case"step-conn-cache":for(var o in t.connCache){var r=t.connCache[o];l.cpSet(o,r.cobj,r.databaseName,r.tableName)}n();break;case"step-view-conns":i.reqConns().then((e=>{i.viewConns(e).then((()=>{l.stepItemCmd("step-tab-group1-show",t),n()}))}));break;case"step-view-database":t.viewDatabase?(r=l.cpGet(1),i.reqDatabaseName(r.cobj).then((e=>{i.viewDatabase(e).then((()=>{l.stepItemCmd("step-tab-group1-show",t),l.cpInfo(1),n()}))}))):n();break;case"step-view-table":r=l.cpGet(1),t.viewTable&&null!=r.databaseName?i.reqTable(r.cobj,r.databaseName).then((e=>{i.viewTable(e,r.cobj).then((()=>{l.stepItemCmd("step-tab-group1-show",t),l.cpInfo(1),n()}))})):n();break;case"step-view-column":r=l.cpGet(1),t.viewColumn&&null!=r.databaseName&&null!=r.tableName?i.reqColumn(r.cobj,r.databaseName,r.tableName).then((e=>{i.viewColumn(e,r.cobj).then((()=>{l.stepItemCmd("step-tab-group1-show",t),l.cpInfo(1),n()}))})):n();break;case"step-tab-group1-show":t.tabGroup1Show&&""!=t.tabGroup1Show&&a.domTabGroup1.show(t.tabGroup1Show),n()}}))},s={fu:e=>e.substring(0,1).toUpperCase()+e.substring(1),cssvar:(e,a,t)=>{if(null==t)return getComputedStyle(e).getPropertyValue(a);e.style.setProperty(a,t)},type:function(e){return{}.toString.call(e).split(" ")[1].replace("]","")},arrayDistinct:e=>Array.from(new Set(e)),formatByteSize:function(e,a=2,t=1024){if(Math.abs(e)<t)return e+" B";const n=1e3==t?["KB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let o=-1;const r=10**a;do{e/=t,++o}while(Math.round(Math.abs(e)*r)/r>=t&&o<n.length-1);return e.toFixed(a)+" "+n[o]},groupBy:function(e,a){var t={};return e.forEach((e=>{var n=a(e);t[n]=t[n]||[],t[n].push(e)})),Object.keys(t)},formatDateTime:(e,a)=>{a=a||Date.now();var t={hour12:!1,timeZone:"Asia/Shanghai"};switch(e){case"date":t=Object.assign({year:"numeric",month:"2-digit",day:"2-digit"},t);break;case"time":t=Object.assign({hour:"numeric",minute:"2-digit",second:"2-digit"},t);break;default:t=Object.assign({year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"2-digit",second:"2-digit"},t)}return new Intl.DateTimeFormat("zh-CN",t).format(a)},msg:function(e,a="warning",t="exclamation-triangle",n=8e3){const o=Object.assign(document.createElement("sl-alert"),{type:a,closable:!0,duration:n,innerHTML:`\n          <sl-icon name="${t}" slot="icon"></sl-icon>\n          ${e}\n        `});return document.body.append(o),o.toast()},confirm:(e,t)=>{null==a.domConfirm&&(a.domConfirm=document.createElement("sl-dialog"),document.body.appendChild(a.domConfirm),a.domConfirm.addEventListener("click",(function(e){"primary"==e.target.type?(a.domConfirm.hide(),t&&t()):"default"==e.target.type&&a.domConfirm.hide()}),!1)),a.domConfirm.innerHTML=`${e}\n        <sl-button slot="footer" type="default">取消</sl-button>\n        <sl-button slot="footer" type="primary">确定</sl-button>`,a.domConfirm.show()},requestStatus:function(e=!0){a.domRequestStatus.loading=e},random:function(e=2e4,a=99999){return Math.floor(Math.random()*(a-e+1)+e)},download:function(e,a){var t=document.createElement("a"),n=new Blob([e]);t.download=a,t.href=URL.createObjectURL(n),document.body.appendChild(t),t.click(),URL.revokeObjectURL(n),t.remove()},actionRun:function(e,o){switch(e){case"theme-light":case"theme-dark":a.theme=e.split("-").pop(),s.themeGrid(a.theme),s.themeEditor(a.theme),"dark"==a.theme?(document.querySelector('sl-menu-item[data-cmd="theme-light"]').checked=!1,document.querySelector('sl-menu-item[data-cmd="theme-dark"]').checked=!0,document.documentElement.classList.add("sl-theme-dark")):(document.querySelector('sl-menu-item[data-cmd="theme-light"]').checked=!0,document.querySelector('sl-menu-item[data-cmd="theme-dark"]').checked=!1,document.documentElement.classList.remove("sl-theme-dark")),l.stepSave();break;case"config-backup-restore":if(null==a.domConfigBackupRestore){var i=document.createElement("div");i.innerHTML=`\n<sl-dialog label="${a.icons.cog}配置备份还原" class="dialog-width" style="--width: 60vw;">\n    <div>\n        <sl-button type="text" data-cmd="config-backup-file">${a.icons.comment}备份配置</sl-button>\n        <sl-button type="text" data-cmd="config-backup-clipboard">${a.icons.clipboard}备份配置到剪贴板</sl-button>\n        <sl-divider></sl-divider>\n        <sl-textarea style="margin:0 1em" placeholder="粘贴配置内容"></sl-textarea>\n        <sl-button type="text" data-cmd="config-restore">${a.icons.comment}还原配置</sl-button>\n    </div>\n</sl-dialog>\n                        `,a.domConfigBackupRestore=i.querySelector("sl-dialog"),document.body.appendChild(i),i.addEventListener("click",(function(e){"primary"==e.target.type?(a.domConfigBackupRestore.hide(),ok&&ok()):"default"==e.target.type&&a.domConfigBackupRestore.hide()}),!1)}a.domConfigBackupRestore.show();break;case"config-backup-file":case"config-backup-clipboard":ls.dkStore.keys().then((a=>{var t=[],n={};a.forEach((e=>t.push(ls.dkStore.getItem(e)))),Promise.all(t).then((t=>{for(var o=0;o<t.length;o++)n[a[o]]=t[o];var r=JSON.stringify(n,null,2);e.endsWith("clipboard")?navigator.clipboard.writeText(r).then((()=>{s.msg("Done!")})):s.download(r,"ndk.json")}))}));break;case"config-restore":var c=o.previousElementSibling.value;try{if(""!=c.trim()){var d=JSON.parse(c);for(let e in d){let a=d[e];ls.dkStore.setItem(e,a)}s.msg("Done!")}else s.msg("配置内容不能为空")}catch(e){console.warn(e),s.msg(e)}break;case"box1-size":s.cssvar(a.domMain,"--box1-width",o),l.stepSave();break;case"sql-execute-selected":case"sql-execute-all":var m=o.getAttribute("panel"),p=r.tabKeys[m],u=e.includes("selected");r.tabEditorExecuteSql(m,u);break;case"sql-formatting":m=o.getAttribute("panel"),p=r.tabKeys[m],t.meFormatter(p.editor);break;case"sql-common":m=o.getAttribute("panel");var b=l.cpGet(m);db.viewExecuteSql({Item1:{"sql-common":n[`sqlFor${b.cobj.type}`]}},m)}},themeGrid:function(e){var t=(e,a)=>{e.classList.remove("ag-theme-alpine"),e.classList.remove("ag-theme-alpine-dark"),"dark"===a?e.classList.add("ag-theme-alpine-dark"):e.classList.add("ag-theme-alpine")};for(const o in a)if(o.startsWith("domGrid")){var n=a[o];t(n,e)}for(var o in a.domTabGroup2.querySelectorAll(".nr-grid-execute-sql").forEach((a=>{t(a,e)})),r.tabKeys){var i=r.tabKeys[o];i.grids&&i.grids.forEach((a=>{var n=a.domGridExecuteSql;t(n,e)}))}},themeEditor:function(e){window.monaco&&("dark"===e?monaco.editor.setTheme("vs-dark"):monaco.editor.setTheme("vs"))},size:function(){var e=document.documentElement.clientHeight;a.domSpliter1.style.height=e-a.domSpliter1.getBoundingClientRect().top-5+"px",["Conns","Database","Table","Column"].forEach((t=>{var n=a[`domGrid${t}`];if("none"!=getComputedStyle(n.parentElement).display){var o=n.getBoundingClientRect().top+5;n.style.height=e-o+"px"}})),a.domTabGroup2.querySelectorAll(".nr-spliter2").forEach((a=>{var t=a.parentElement;if("none"!=getComputedStyle(t).display){var n=a.getBoundingClientRect().top+5;a.style.height=e-n+"px";var o=r.tabKeys[t.name];o&&o.grids&&setTimeout((()=>{o.grids.forEach((a=>{if("none"!=getComputedStyle(a.domTabPanel).display){var t=e-a.domGridExecuteSql.getBoundingClientRect().top-5+"px";if(a.domGridExecuteSql.style.height=t,!a.gridOps&&a.opsExecuteSql){var n=new agGrid.Grid(a.domGridExecuteSql,a.opsExecuteSql).gridOptions;a.domFilterExecuteSql.addEventListener("input",(function(){n.api.setQuickFilter(this.value)}),!1),a.gridOps=n}}}))}),200)}}))}},c={buildSqlNumberType:{SQLite:"",MySQL:"bigint,int,tinyint,float,integer,year,double,real",MariDB:"bigint,int,tinyint,float,integer,year,double,real",Oracle:"decimal,float,integer,number",SQLServer:"bigint,int,float,money,numeric,smallint,smallmoney,tinyint",PostgreSQL:"int2,int4,int8,integer,smallint,serial,float4,float8,real,numeric,money"},buildSqlQuote:(e,a)=>{switch(e){case"SQLite":case"SQLServer":return`[${a}]`;case"MySQL":case"MariaDB":return"`"+a+"`";case"Oracle":case"PostgreSQL":return`"${a}"`;default:return a}},buildSqlFullTableName:(e,a)=>{var t=[c.buildSqlQuote(e.cobj.type,e.databaseName)];return null!=a.TableSchema&&""!=a.TableSchema&&t.push(c.buildSqlQuote(e.cobj.type,a.TableSchema)),t.push(c.buildSqlQuote(e.cobj.type,a.TableName)),t.join(".")},buildSqlSelect:(e,t,n)=>{t=c.buildSqlFullTableName(e,t);var o=[];if(n)return n.forEach((a=>o.push(c.buildSqlQuote(e.cobj.type,a.ColumnName)))),`SELECT ${o.join(",")} FROM ${t}`;var r=a.config.selectDataLimit;switch(e.cobj.type){case"SQLServer":return`SELECT TOP ${r} * FROM ${t}`;case"MySQL":case"MariaDB":return`SELECT * FROM ${t} LIMIT 0,${r}`;case"Oracle":return`SELECT * FROM ${t} WHERE ROWNUM <= ${r}`;case"SQLite":case"PostgreSQL":return`SELECT * FROM ${t} LIMIT ${r} OFFSET 0`}},buildSqlInsert:(e,t,n)=>{t=c.buildSqlFullTableName(e,t);var o=[],r=[];return n.forEach((t=>{o.push(c.buildSqlQuote(e.cobj.type,t.ColumnName));var n=(t.ColumnComment||"").replaceAll("\n"," "),i=t.DataLength>0?t.DataLength:999,l=`'${n.replaceAll("'","''").substring(0,i)}'`;["bool","boolean"].includes(t.DataType)?l="false":c.buildSqlNumberType[e.cobj.type].indexOf(t.DataType)>=0?l=0:"SQLite"==e.cobj.type?t.PrimaryKey>0&&["nvarchar","varchar","text"].includes(t.DataType)?l="hex(randomblob(16))":["datetime","date","time"].includes(t.DataType)&&(l=`'${s.formatDateTime(t.DataType)}'`):"MySQL"==e.cobj.type?t.PrimaryKey>0&&["varchar"].includes(t.DataType)?l="uuid()":["datetime","date","time"].includes(t.DataType)&&(l=`'${s.formatDateTime(t.DataType)}'`):"SQLServer"==e.cobj.type&&(t.PrimaryKey>0&&["nvarchar","varchar"].includes(t.DataType)?l="newid()":["nvarchar","nchar","ntext"].includes(t.DataType)?l="N"+l:["datetime","date","time"].includes(t.DataType)&&(l=`'${s.formatDateTime(t.DataType)}'`)),r.push(`-- ${t.ColumnName}(${t.PrimaryKey>0?a.icons.key+t.PrimaryKey+", ":""}${t.ColumnType}, ${1==t.IsNullable?"null":"not null"}) ${n} \n${l}`)})),`INSERT INTO ${t}(${o.join(",")}) VALUES(${r.join(",\n")})`},buildSqlUpdate:(e,a,t,n)=>{a=c.buildSqlFullTableName(e,a);var o=[],r=[];return t.forEach((a=>{var t=c.buildSqlQuote(e.cobj.type,a.ColumnName);a.PrimaryKey>0?r.push(`${t} = ''`):o.push(`${t} = ''`)})),0==r.length&&(r.push(o[0]),o=o.splice(0,1)),`UPDATE ${a} SET ${o.join(",")} WHERE ${r.join(" AND ")}`},buildSqlDelete:(e,a,t,n)=>{a=c.buildSqlFullTableName(e,a);var o=[],r=[];return t.forEach((a=>{var t=c.buildSqlQuote(e.cobj.type,a.ColumnName);0==o.length&&o.push(`${t} = ''`),a.PrimaryKey>0&&r.push(`${t} = ''`)})),0==r.length&&(r=o),`DELETE FROM ${a} WHERE ${r.join(" AND ")}`}},d={event:function(){document.body.addEventListener("click",(function(e){var a=e.target.getAttribute("data-cmd");null!=a&&s.actionRun(a,e.target)}),!1),a.domSpliter1.querySelector(".nrc-spliter-bar").addEventListener("mousedown",(function(e){var a=e.target.previousElementSibling,t=e.target.nextElementSibling,n=e.target.parentElement,o=a.clientWidth,r=function(a){var r=o-(e.clientX-a.clientX);r=Math.max(0,r),r=Math.min(n.clientWidth-t.clientWidth,r),t.style.display="block",t.style.left=`${r}px`},i=function(){t.style.display="none";var e=t.style.left;e.includes("%")||(e=(parseInt(t.style.left||a.clientWidth)/n.clientWidth*100).toFixed(4)+"%"),t.style.left=e,s.actionRun("box1-size",e),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i),this.releaseCapture&&this.releaseCapture()};window.addEventListener("mousemove",r,!1),window.addEventListener("mouseup",i,!1),this.setCapture&&this.setCapture()}),!1),a.domSpliter1.querySelector(".nrc-spliter-bar").addEventListener("dblclick",(function(e){var a=(e.clientY-e.target.getBoundingClientRect().top)/e.target.clientHeight,t=e.target.nextElementSibling;a<.33333?(t.style.left="85%",s.actionRun("box1-size","85%")):a>.33333&&a<.66666?(t.style.left="50%",s.actionRun("box1-size","50%")):(t.style.left="15%",s.actionRun("box1-size","15%"))})),a.domTabGroup1.addEventListener("sl-tab-show",(function(){setTimeout((()=>{s.size(),step.stepSave()}),1)}),!1),["conns","database","table","column"].forEach((e=>{e=s.fu(e),a[`domFilter${e}`].addEventListener("input",(function(){var t=a[`gridOps${e}`];t&&t.api&&t.api.setQuickFilter(this.value)}))})),a.domTabGroup2.addEventListener("sl-close",(async e=>{var t=e.target,n=a.domTabGroup2.querySelector(`sl-tab-panel[name="${t.panel}"]`);if(t.active){var o=t.previousElementSibling||t.nextElementSibling;o.nodeName!="sl-tab-panel".toUpperCase()?a.domTabGroup2.show(o.panel):step.cpInfo("reset")}t.remove(),n.remove(),r.tabNavFix(),delete r.tabKeys[t.panel],step.cpRemove(t.panel)})),a.domTabGroup2.addEventListener("sl-tab-show",(function(e){step.cpInfo(e.detail.name),setTimeout((()=>{s.size()}),1)}),!1),window.addEventListener("resize",(()=>s.size()),!1)}};window.addEventListener("DOMContentLoaded",(function(){d.event(),step.stepStart().then((()=>{a.domLoading.style.display="none",a.domMain.style.visibility="visible",setTimeout((()=>console.clear()),2e3)}))}),!1),window.agg=e,window.vary=a,window.ls=o,window.db=i,window.fn=s,window.me=t,window.tab=r,window.step=l,window.build=c,window.sqlFor=n,window.init=d})();